#!/usr/bin/env php
<?php

require __DIR__.'/../vendor/autoload.php';

use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Input\InputDefinition;
use Symfony\Component\Console\Input\InputArgument;
use Symfony\Component\EventDispatcher\EventDispatcher;

$input = new ArgvInput(null, new InputDefinition([
    new InputArgument('path', InputArgument::REQUIRED, 'The path to the pimple config'),
]));

$c = require $input->getArgument('path');


$workflow = new Workflow(new EventDispatcher());

foreach ($c['etl'] as $etl) {
  $workflow->process($etl);
}

$workflow->flush($workflow->getContext());
